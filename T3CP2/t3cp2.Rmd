---
title: "t3cp2"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r echo=FALSE, results='hide', warning=FALSE, message=FALSE}
require(ggplot2, quietly = TRUE)
library(ggfortify, quietly = TRUE)
# http://rpubs.com/sinhrks/basics
require(GGally, quietly = TRUE)
require(reshape2, quietly = TRUE)
require(dplyr, quietly = TRUE)
library(knitr, quietly = TRUE)
library(cluster)
library(ggdendro)
library(plotly)
library(Rtsne)
theme_set(theme_bw())
```

```{r echo=FALSE}
emendasArea = read.csv(file = "emendas_area_parlamentar.csv", stringsAsFactors = TRUE)
emendasDetalhes = read.csv(file = "emendas_detalhes_parlamentar.csv", stringsAsFactors = TRUE)
```
# Dados
<p>Os dados escolhidos para a tarefa é um subconjunto do arquivo emendas_area_parlamentar.csv, selecionando deste arquivos apenas as áreas: agricultura, defesa nacional e cultura. Essas três áreas foram escolhidas porque, provavelmente, são áreas mais distintas uma das outras, ao invés de saneamento e urbanismo, onde creio que são áreas mais correlacionadas. Sendo assim, espero os grupos formados sejam bem definidos e os eixos criados pelo PCA não sejam tão próximos, para facilitar visualização.<p>
```{r}
dataframe = emendasArea %>%
  select(NOME_PARLAMENTAR, Agricultura, Defesa.Nacional, Cultura)

dataframe = na.omit(dataframe)

```

# PCA

```{r}
row.names(dataframe) = dataframe$NOME_PARLAMENTAR
# scale()
pr.out = prcomp(log(select(dataframe, -NOME_PARLAMENTAR) + 1), scale = TRUE) 

kable(pr.out$rotation)
biplot(pr.out, scale = 0)

autoplot(pr.out, label = TRUE, label.size = 3, shape = FALSE)

autoplot(pr.out, label = TRUE, label.size = 3, shape = FALSE, 
         loadings = TRUE, loadings.colour = 'blue',
         loadings.label = TRUE, loadings.label.size = 3)

```
<p>Utilizando o PCA, é possível observar que os eixos de agricultura e cultura andam bem próximos, nos indicando que a nuvem de deputados localizada entre esses dois eixos tiveram suas emendas focadas nessas duas áreas e quase sem atuação com relação a defesa nacional.<p>
<p> Mais na parte inferior do gráfico existe a formação de nuvens bem distintas das outras com atuação mais forte em defesa nacional e alguns poucos no grupo de Vanessa Grazziotin com ligação mais forte em relação aos eixos de agricultura e cultura.<p>
<p>Outros ficaram bem afastados, indicando que atuam em outras áreas.<p>

# Porcentagem da variância explicada: 
```{r}

plot_pve <- function(prout){
  pr.var <- pr.out$sdev^2
  pve <- pr.var / sum(pr.var)
  df = data.frame(x = 1:NROW(pve), y = cumsum(pve))
  ggplot(df, aes(x = x, y = y)) + 
    geom_point(size = 3) + 
    geom_line() + 
    labs(x='Principal Component', y = 'Cumulative Proportion of Variance Explained')
}

plot_pve(pr.out)
```
<p>Com esse gráfico podemos saber o quanto que estamos perdendo reduzindo de três variáveis ou fatores para dois. Como mostrado na figura, usando duas variáveis conseguimos explicar algo próximo de 80% da variância total obtida apenas quando se usa todo o conjunto de variáveis.<p>

# t-SNE

```{r}

tsne.out = Rtsne(log(select(dataframe, -NOME_PARLAMENTAR) + 1), 
                 verbose = TRUE, check_duplicates=FALSE)

df = as.data.frame(tsne.out$Y)
df$NOME_PARLAMENTAR = dataframe$NOME_PARLAMENTAR

myPlot <- plot_ly(df, x = V1, y = V2, text = paste("Parlamentar: ", NOME_PARLAMENTAR), name = "nome", mode = "markers") %>%
  layout(
      title = "t-SNE",
      xaxis = list(title = "V1"),
      yaxis = list(title = "V2"),
      margin = list(l = 65)
    )

myPlot 
```
<p>Já sobre a visualização do t-SNE, observamos grupos mais bem formados e distintos entre si. Com isso é mais fácil notar parlamentares com emendas em áreas semelhantes e proximidades entre grupos. Nesse grupo de dados tivemos quatro grupos bem separados ficando em direções opostas e apenas um grupo com distância menor em relação aos outros.<p> 

# Conclusão
<p> Para esse caso, com esse conjunto de dados, utilizando o PCA foi mais fácil de entender a quais áreas cada ponto está relacionado, visulizar pontos que abrangem mais de uma área de atuação, como também pontos que não se encaixam com as áreas escolhidas, ficando localizados em extremos contrários às direções dos vetores. Já o t-SNE, facilitou a distinção de grupos, formando aglomerações bem definidas. A partir desses grupos gerados pelo t-SNE podemos fazer uma análise mais detalhada de cada grupo, vendo quais deputados fazem parte, se pertencem ao mesmo estado ou então se as áreas das emendas desse grupo realmente tem ligação.<p>
<p>Portanto, dependendo do que se queira extrair do conjunto de dados que podemos dizer qual ferramenta será mais apropriada.<p>